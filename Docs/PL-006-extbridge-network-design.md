# ExtBridge ネットワーク設計書

## 1. はじめに

### 1.1 目的
本ドキュメントは、ExtBridgeシステムのネットワーク構成と設計方針について定義することを目的とします。

### 1.2 対象範囲

- ネットワーク構成図
- サブネット設計
- セキュリティグループ・ファイアウォールルール
- ロードバランサー構成
- 接続方式（VPN/Direct Connect）
- ネットワーク監視・運用方針

## 2. ネットワーク構成

### 2.1 全体構成図
```
[インターネット]
      |
[CloudFront]
      |
[ALB (Application Load Balancer)]
      |
[Web Server (Public Subnet)]
      |
[Application Server (Private Subnet)]
      |
[RDS Proxy] - [RDS (Multi-AZ)]
      |
[ElastiCache (Redis)]
```

### 2.2 VPC設計
- **VPC CIDR**: 10.0.0.0/16
- アベイラビリティゾーン: ap-northeast-1a, ap-northeast-1c

#### サブネット設計
| サブネット種別 | CIDRブロック | AZ | 用途 |
|--------------|-------------|----|------|
| Public-A | 10.0.1.0/24 | ap-northeast-1a | ALB, NAT Gateway |
| Public-B | 10.0.2.0/24 | ap-northeast-1c | ALB, NAT Gateway |
| Private-App-A | 10.0.3.0/24 | ap-northeast-1a | アプリケーションサーバー |
| Private-App-B | 10.0.4.0/24 | ap-northeast-1c | アプリケーションサーバー |
| Private-DB-A | 10.0.5.0/24 | ap-northeast-1a | RDS, ElastiCache |
| Private-DB-B | 10.0.6.0/24 | ap-northeast-1c | RDS, ElastiCache |

## 3. セキュリティグループ

### 3.1 ALBセキュリティグループ
- インバウンド: HTTP(80), HTTPS(443) すべて許可
- アウトバウンド: すべて許可

### 3.2 Webサーバーセキュリティグループ
- インバウンド: ALBセキュリティグループからのHTTP(80)のみ許可
- アウトバウンド: すべて許可

### 3.3 アプリケーションサーバーセキュリティグループ
- インバウンド: Webサーバーセキュリティグループからのアプリケーション通信のみ許可
- アウトバウンド: すべて許可

### 3.4 データベースセキュリティグループ
- インバウンド: アプリケーションサーバーセキュリティグループからのデータベースポート（3306）のみ許可
- アウトバウンド: 制限なし

## 4. ネットワーク接続

### 4.1 インターネット接続
- CloudFront+ALBによるHTTPS終端
- WAFによるWebアプリケーションファイアウォールの適用

### 4.2 オンプレミス接続

- AWS Site-to-Site VPN接続
- 将来的なDirect Connect導入を見据えた設計

## 5. ロードバランシング

### 5.1 ALB設定

- リスナー: HTTPS（443）のみ許可
- ターゲットグループ: EC2インスタンス（Webサーバー）
- ヘルスチェック: HTTP：80/health
- スティッキーセッション: 有効

## 6. ネットワーク監視・運用

### 6.1 監視項目

- ネットワークスループット
- レイテンシー
- エラーレート
- 接続数

### 6.2 アラート設定
- しきい値超過時のCloudWatchアラーム設定
- SNSによる通知

## 7. ディザスタリカバリ

### 7.1 マルチAZ構成
- アプリケーション層、データ層ともにマルチAZ構成
- 自動フェイルオーバー設定

### 7.2 バックアップ
- ネットワーク構成の定期的なバックアップ
- 設定変更管理の徹底

## 8. セキュリティ対策

### 8.1 WAFルール
- OWASPトップ10対策ルールの適用
- カスタムルールの設定

### 8.2 暗号化
- 転送中のデータ: TLS 1.2以上
- 保管データ: KMSによる暗号化

## 9. 今後の拡張性

### 9.1 マルチリージョン展開
- グローバル展開時のネットワーク設計方針
- リージョン間のデータレプリケーション

### 9.2 ハイブリッドクラウド
- オンプレミス環境との連携
- プライベート接続の拡張

## 10. 付録

### 10.1 用語集
- VPC: Virtual Private Cloud
- ALB: Application Load Balancer
- AZ: アベイラビリティゾーン
- CIDR: Classless Inter-Domain Routing

### 10.2 参考資料
- AWS Well-Architected Framework
- AWS セキュリティベストプラクティス

## 文書管理情報

| 項目 | 内容 |
|------|------|
| 文書ID | PL-006 |
| バージョン | 1.0 |
| 作成日 | 2025年5月16日 |
| 最終更新日 | 2025年5月16日 |
| 作成者 | Windsurf+Network-1 |
| 承認者 | Windsurf+Architect-1 |
| 承認日 | 2025年5月16日 |
| ステータス | レビュー中 |
