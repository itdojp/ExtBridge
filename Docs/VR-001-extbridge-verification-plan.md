# VR-001 ExtBridge 動作検証計画書

| 文書情報 | |
|------|------|
| 文書名 | ExtBridge 動作検証計画書 |
| バージョン | 1.0 |
| 作成日 | 2025年5月16日 |
| 最終更新日 | 2025年5月16日 |
| ステータス | ドラフト |

## 目次

1. [検証計画概要](#1-検証計画概要)
2. [検証環境](#2-検証環境)
3. [検証範囲と手法](#3-検証範囲と手法)
4. [詳細検証シナリオ](#4-詳細検証シナリオ)
5. [評価基準](#5-評価基準)
6. [検証スケジュール](#6-検証スケジュール)
7. [検証体制と役割](#7-検証体制と役割)
8. [リスク管理](#8-リスク管理)
9. [検証成果物](#9-検証成果物)
10. [承認](#10-承認)

## 1. 検証計画概要

### 1.1 背景と目的

本検証は、Exticを活用した個人契約クラウドサービス管理システム「ExtBridge」の構築において、技術的な実現可能性と有効性を確認するために実施するものです。システム設計・開発着手前に、主要な機能や連携方式が要件を満たすことを確認し、潜在的な課題や制限事項を早期に特定することを目的とします。

### 1.2 検証の位置づけ

本検証はExtBridgeプロジェクトの第1フェーズとして位置づけられ、検証結果は以下の判断材料となる：
- Exticを用いたソリューションの技術的実現可能性の確認
- 詳細設計への入力情報
- 開発リスクの特定と対策策定
- 運用体制の検討材料

### 1.3 検証の範囲

本検証では、ExtBridgeの主要機能に関する技術的検証を行い、以下の内容を含む：
- SAML SSOによる認証連携
- SCIMによるユーザープロビジョニング
- 各クラウドサービスとの連携
- ユーザーエクスペリエンス
- パフォーマンス特性
- エラー処理と例外対応

## 2. 検証環境

### 2.1 Extic検証環境

| 項目 | 内容 |
|------|------|
| Exticバージョン | 最新安定版 |
| 環境タイプ | テスト環境 |
| 有効化オプション | 多要素認証、コマンド実行機能、外部IdP連携 |
| テストユーザー | 管理者1名、一般ユーザー10名 |
| テストグループ | 開発部門、デザイン部門、マーケティング部門 |

### 2.2 連携サービス検証環境

| サービス名 | 環境タイプ | アカウントタイプ | テストユーザー数 |
|------|------|------|------|
| GitHub | Organization（テスト用） | Team プラン | 5ユーザー |
| Figma | Organization（テスト用） | Professional プラン | 5ユーザー |
| JetBrains | Hub テスト環境 | Team ライセンス | 5ユーザー |
| Adobe CC | テスト環境 | Single App ライセンス | 5ユーザー |
| その他サービス | 各サービスのテスト環境 | - | 必要に応じて |

### 2.3 ネットワーク環境

- 社内テスト用ネットワークセグメント
- インターネット接続環境
- 必要に応じてプロキシ経由での接続も検証

### 2.4 ハードウェア・ソフトウェア要件

| 項目 | 要件 |
|------|------|
| サーバーリソース | CPU: 4コア以上、メモリ: 16GB以上、ストレージ: 100GB以上 |
| OS | Linux (Ubuntu 22.04 LTS または同等) |
| ミドルウェア | Webサーバー、データベース、バックアップツール |
| クライアント環境 | 標準的なWebブラウザ（Chrome, Firefox, Edge, Safari最新版） |

## 3. 検証範囲と手法

### 3.1 段階的検証アプローチ

検証は以下の3段階で実施する：

1. **単体機能検証**：Exticの基本機能および各連携機能を個別に検証
2. **サービス連携検証**：各クラウドサービスとの連携を個別に検証
3. **統合検証**：エンドツーエンドのシナリオに基づいた統合的な検証

### 3.2 単体機能検証

#### 3.2.1 Extic基本機能

| ID | 検証項目 | 検証内容 | 期待結果 |
|------|------|------|------|
| BF-01 | ユーザー管理 | ユーザーの作成・更新・無効化 | 適切にユーザーライフサイクルが管理できること |
| BF-02 | グループ管理 | グループの作成・更新・削除、メンバー管理 | 組織構造に合わせたグループ管理ができること |
| BF-03 | 認証機能 | パスワード認証、多要素認証 | セキュリティポリシーに準拠した認証が行えること |
| BF-04 | ポータル機能 | アプリケーション表示、カスタマイズ | ユーザーごとのアクセス権に応じた表示ができること |

#### 3.2.2 IdP機能

| ID | 検証項目 | 検証内容 | 期待結果 |
|------|------|------|------|
| ID-01 | SAML IdP機能 | Assertionの生成・検証 | 標準に準拠したAssertionの生成・交換ができること |
| ID-02 | 証明書管理 | 証明書の登録・更新 | 証明書の適切な管理とエラー時の検知ができること |
| ID-03 | 属性マッピング | ユーザー属性のマッピング | 適切な属性情報がSAML Assertionに含まれること |
| ID-04 | IdP/SP開始フロー | 両方向のSSOフロー | 両方向からのSSO連携が正常に動作すること |

#### 3.2.3 プロビジョニング機能

| ID | 検証項目 | 検証内容 | 期待結果 |
|------|------|------|------|
| PV-01 | SCIM連携 | SCIM経由のユーザー同期 | 指定したユーザー情報が適切に同期されること |
| PV-02 | グループ同期 | グループ情報の同期 | グループ階層・メンバーシップが適切に同期されること |
| PV-03 | エラー処理 | 同期エラー発生時の処理 | エラーの検知・通知・リカバリーが行えること |
| PV-04 | 同期タイミング | リアルタイム同期と定期同期 | 設定したタイミングで正確に同期されること |

### 3.3 サービス連携検証

各クラウドサービスとの連携について、個別に以下の検証を行う：

#### 3.3.1 GitHub連携

| ID | 検証項目 | 検証内容 | 期待結果 |
|------|------|------|------|
| GH-01 | SSO設定 | GitHub OrganizationでのSAML設定 | SSOでのアクセスが可能になること |
| GH-02 | SCIM連携 | ユーザーおよびチーム同期 | ユーザー・チーム情報が同期されること |
| GH-03 | 権限管理 | リポジトリアクセス権限の連携 | グループベースの権限管理ができること |
| GH-04 | トークン認証 | PAT・SSH鍵との連携 | トークン認可が適切に行われること |

#### 3.3.2 Figma連携

| ID | 検証項目 | 検証内容 | 期待結果 |
|------|------|------|------|
| FG-01 | SSO設定 | Figma OrganizationでのSAML設定 | SSOでのアクセスが可能になること |
| FG-02 | SCIM連携 | ユーザーおよびチーム同期 | ユーザー・チーム情報が同期されること |
| FG-03 | シート管理 | ライセンスシートの割り当て管理 | 適切なシート割り当てができること |
| FG-04 | プロジェクト権限 | プロジェクトアクセス権の連携 | グループベースの権限管理ができること |

#### 3.3.3 JetBrains連携

| ID | 検証項目 | 検証内容 | 期待結果 |
|------|------|------|------|
| JB-01 | Hub SSO設定 | JetBrains HubでのSAML設定 | SSOでのアクセスが可能になること |
| JB-02 | ライセンス管理 | License Vaultとの連携 | ライセンスの割り当て管理ができること |
| JB-03 | IDE認証連携 | IDEからのログイン連携 | IDEでのシームレスな認証が行えること |
| JB-04 | プロジェクト権限 | プロジェクトアクセス権の連携 | グループベースの権限管理ができること |

#### 3.3.4 Adobe連携

| ID | 検証項目 | 検証内容 | 期待結果 |
|------|------|------|------|
| AD-01 | Admin Console連携 | Adobe AdminへのSAML設定 | SSOでのアクセスが可能になること |
| AD-02 | Single App管理 | 個別アプリのライセンス管理 | アプリケーション単位の割り当てができること |
| AD-03 | Federated ID連携 | Federatedアカウントの設定 | IdP経由のアカウント管理ができること |
| AD-04 | グループ同期 | Adobe製品グループの同期 | グループベースの割り当てができること |

### 3.4 統合検証

#### 3.4.1 エンドツーエンドシナリオ

| ID | 検証項目 | 検証内容 | 期待結果 |
|------|------|------|------|
| EE-01 | 新規ユーザー追加 | 新規ユーザーの追加から全サービス利用まで | シームレスなユーザー追加・プロビジョニングができること |
| EE-02 | ユーザー無効化 | ユーザー無効化時の全サービスでの動作 | 無効化したユーザーが全サービスでアクセスできなくなること |
| EE-03 | 権限変更 | グループ変更時の権限反映 | 適切なタイミングで権限変更が反映されること |
| EE-04 | ユーザー復元 | 無効化ユーザーの復元 | 正しく元の状態に復元されること |

#### 3.4.2 フェイルオーバー検証

| ID | 検証項目 | 検証内容 | 期待結果 |
|------|------|------|------|
| FO-01 | ネットワーク障害 | 一時的なネットワーク遮断時の動作 | 適切なエラー処理と回復ができること |
| FO-02 | サービス障害 | 外部サービス停止時の動作 | 他サービスへの影響を最小化できること |
| FO-03 | データ不整合 | データ不整合発生時の検知と修復 | 不整合を検知し修復できること |
| FO-04 | 証明書問題 | 証明書期限切れ・無効時の動作 | 適切な警告と対策が行えること |

#### 3.4.3 パフォーマンス検証

| ID | 検証項目 | 検証内容 | 期待結果 |
|------|------|------|------|
| PF-01 | 認証速度 | SSO認証完了までの時間測定 | 3秒以内に認証が完了すること |
| PF-02 | 同時接続性能 | 複数ユーザーの同時ログイン | 100ユーザー同時接続でも性能劣化がないこと |
| PF-03 | プロビジョニング時間 | ユーザー同期完了までの時間 | 5分以内にプロビジョニングが完了すること |
| PF-04 | スケーラビリティ | ユーザー数増加時の性能変化 | ユーザー数増加に対して線形的な性能劣化であること |

## 4. 詳細検証シナリオ

### 4.1 新規ユーザー追加シナリオ (EE-01)

#### 前提条件
- ExtBridge環境が正常に稼働している
- 連携対象の各クラウドサービスが利用可能
- 管理者アカウントでログインしている

#### 検証手順
1. Extic管理コンソールで新規ユーザーを作成
   - 必要な属性情報を入力
   - 適切なグループに所属させる
   - 各サービスへのアクセス権を設定
2. ユーザー作成後、各サービスへのプロビジョニング状況を確認
   - GitHub Organizationでのユーザー状態確認
   - Figma Organizationでのユーザー状態確認
   - JetBrains Hubでのユーザー状態確認
   - Adobe Admin Consoleでのユーザー状態確認
3. 新規ユーザーアカウントでExtBridgeポータルにログイン
4. ポータルに表示されたアプリケーションへのシングルサインオンを実行
   - 各サービスへの初回アクセス時の動作確認
   - 2回目以降のアクセス時の動作確認
5. 各サービスでの権限状態を確認
   - 設定した権限通りにアクセスできるか検証
   - 権限のないリソースにアクセスできないことを確認

#### 期待結果
- ユーザー作成から5分以内に全サービスにプロビジョニングが完了すること
- ユーザーがポータルから各サービスに認証情報の入力なしでアクセスできること
- 設定した権限に従って適切なアクセス制御が行われること
- エラーが発生した場合は適切にエラーメッセージが表示されること

#### 検証記録項目
- 各ステップの完了時間
- 発生したエラーとその内容
- 画面キャプチャ
- ユーザー体験に関する所見

### 4.2 ユーザー無効化シナリオ (EE-02)

#### 前提条件
- 検証用ユーザーが全サービスに正常にプロビジョニングされている
- 各サービスへのアクセスが可能な状態である
- 管理者アカウントでログインしている

#### 検証手順
1. Extic管理コンソールでユーザーアカウントを無効化
2. 無効化の反映時間を測定
3. 各サービスでのアクセス状態を確認
   - GitHubへのアクセス試行
   - Figmaへのアクセス試行
   - JetBrains製品へのアクセス試行
   - Adobe製品へのアクセス試行
4. ライセンス割り当て状態の確認
   - 各サービスでのライセンスが適切に回収されているか確認
5. 管理者コンソールでユーザーを再有効化
6. 再有効化後のアクセス回復状況を確認

#### 期待結果
- ユーザー無効化後、30分以内に全サービスでアクセスが停止されること
- ライセンスが適切に回収され、未割当状態になること
- 再有効化後、30分以内にアクセスが回復すること
- 全プロセスがエラーなく完了すること

#### 検証記録項目
- 各ステップの完了時間
- 各サービスでのアクセス停止確認時刻
- 発生したエラーとその内容
- ライセンス状態の変化

### 4.3 権限変更シナリオ (EE-03)

#### 前提条件
- 検証用ユーザーが複数のグループに所属している
- 各サービスへの異なるレベルのアクセス権を持っている
- 管理者アカウントでログインしている

#### 検証手順
1. Extic管理コンソールでユーザーのグループ所属を変更
   - あるグループから別のグループへ移動
   - 追加のグループへの所属を追加
   - グループからの削除
2. 権限変更の反映時間を測定
3. 各サービスでの権限変更結果を確認
   - GitHubでのリポジトリアクセス権の変更確認
   - Figmaでのプロジェクトアクセス権の変更確認
   - JetBrainsでのプロジェクト権限の変更確認
   - Adobeでのアプリケーションアクセス権の変更確認
4. エラー発生時の通知機能を確認

#### 期待結果
- 権限変更が30分以内に全サービスに反映されること
- 権限変更に従って適切なアクセス制御が行われること
- エラーが発生した場合は適切に通知されること
- 変更ログが正確に記録されていること

#### 検証記録項目
- 各変更の反映時間
- 各サービスでの権限確認結果
- 発生したエラーとその内容
- 変更ログの内容

## 5. 評価基準

### 5.1 機能面評価基準

| 評価項目 | 合格基準 | 不合格条件 |
|------|------|------|
| 必須機能の動作 | 必須機能が100%動作すること | 必須機能に未動作があること |
| エラー処理 | エラー発生時に適切なメッセージが表示され、リカバリーが可能なこと | エラー時に適切な対応ができないこと |
| 連携機能 | 各サービスとの連携が仕様通りに動作すること | 連携機能に仕様との不一致があること |
| セキュリティ機能 | セキュリティ要件を満たしていること | セキュリティ上の脆弱性が見つかること |

### 5.2 性能面評価基準

| 評価項目 | 合格基準 | 不合格条件 |
|------|------|------|
| 認証処理時間 | 3秒以内に完了すること | 3秒を超える処理時間が発生すること |
| プロビジョニング時間 | 5分以内に完了すること | 5分を超える処理時間が発生すること |
| 同時アクセス性能 | 100ユーザー同時アクセスに耐えること | 多重アクセス時にエラーや著しい性能劣化が発生すること |
| 応答時間 | 平均応答時間が2秒以内であること | 平均応答時間が2秒を超えること |

### 5.3 ユーザー体験評価基準

| 評価項目 | 合格基準 | 不合格条件 |
|------|------|------|
| 操作性 | 主要操作が5クリック以内で完了すること | 操作が複雑で分かりにくいこと |
| 視認性 | 情報が整理され、必要な情報が一目で確認できること | 情報が散乱し、重要情報の確認が困難なこと |
| エラーメッセージ | エラー発生時に原因と対処方法が明確に表示されること | エラーメッセージが不明瞭または不適切なこと |
| 一貫性 | 操作方法や画面デザインに一貫性があること | 操作方法や画面デザインに一貫性がないこと |

## 6. 検証スケジュール

| フェーズ | 開始日 | 終了日 | 主要マイルストーン |
|------|------|------|------|
| 検証準備 | 2025/6/1 | 2025/6/15 | 検証環境構築完了、検証シナリオ確定 |
| 単体機能検証 | 2025/6/16 | 2025/6/30 | Extic基本機能検証完了 |
| サービス連携検証 | 2025/7/1 | 2025/7/15 | 各サービス連携検証完了 |
| 統合検証 | 2025/7/16 | 2025/7/31 | エンドツーエンド検証完了 |
| 報告書作成 | 2025/8/1 | 2025/8/10 | 検証結果報告書提出 |

## 7. 検証体制と役割

### 7.1 検証チーム構成

| 役割 | 担当者 | 主な責任 |
|------|------|------|
| 検証責任者 | TBD | 検証全体の統括と進捗管理 |
| 技術リード | TBD | 技術的な判断とトラブルシューティング |
| Extic専門家 | TBD | Extic関連の設定と検証 |
| サービス連携担当 | TBD | 各クラウドサービスとの連携検証 |
| QA担当 | TBD | 検証計画の実行と結果記録 |
| ユーザー体験評価担当 | TBD | UX/UI評価と改善提案 |

### 7.2 ステークホルダー

| 役割 | 担当者/部門 | 関与度 |
|------|------|------|
| プロジェクトスポンサー | TBD | 検証結果の最終承認 |
| IT部門責任者 | TBD | 定期的なレビュー参加 |
| 情報セキュリティ担当 | TBD | セキュリティ要件のレビュー |
| エンドユーザー代表 | TBD | ユーザー体験評価への参加 |

## 8. リスク管理

### 8.1 検証における主なリスク

| リスク | 影響度 | 発生確率 | 対策 |
|------|------|------|------|
| 検証環境の不具合 | 高 | 中 | バックアップ環境の準備、復旧手順の整備 |
| サービス側のAPI変更 | 中 | 低 | 各サービスの情報を定期確認、代替手段の検討 |
| テストデータの不足 | 中 | 中 | 事前に十分なテストデータを準備 |
| ライセンス/アカウントの制限 | 高 | 中 | 検証に必要なライセンス数を事前確保 |
| スケジュール遅延 | 中 | 高 | バッファの確保、進捗管理の徹底 |

### 8.2 リスク発生時の対応

1. リスク発生の検知と報告
2. 影響範囲の評価
3. 対応策の検討と実施
4. 検証計画の修正（必要に応じて）
5. 結果の報告と記録

## 9. 検証成果物

### 9.1 検証結果報告書

- 検証概要
- 検証結果サマリー
- 詳細検証結果（シナリオごと）
- 発見された課題と対策案
- 結論と提言

### 9.2 技術的成果物

- 最適構成パラメータ一覧
- 連携設定サンプル
- 検証時の画面キャプチャ/動画
- トラブルシューティングガイド
- 検証中に作成したスクリプト/ツール

### 9.3 検証環境成果物

- 検証環境構成図
- 設定ファイルバックアップ
- テストユーザー/データ一覧
- 検証シナリオ実行記録

## 10. 承認

| 役割 | 氏名 | 承認日 |
|------|------|------|
| 作成者 |  |  |
| 検証責任者 |  |  |
| プロジェクト責任者 |  |  |
| IT部門責任者 |  |  |

## 11. デプロイ手順

### 11.1 Google Cloud Runへのデプロイ

#### 11.1.1 前提条件

- Google Cloud Platform (GCP)アカウント
- Google Cloud SDKのインストール
- Dockerのインストール
- 必要な権限：
  - Cloud Run Admin
  - Storage Admin
  - Service Account User

#### 11.1.2 環境変数の設定

以下の環境変数をGoogle Cloud Runサービスに設定する必要があります：

| 環境変数 | 説明 | 例 |
|------|------|------|
| NODE_ENV | 実行環境 | production |
| PORT | アプリケーションポート | 8080 |
| MONGODB_URI | MongoDB接続文字列 | mongodb+srv://user:password@cluster.mongodb.net/extbridge |
| JWT_SECRET | JWT署名用シークレット | (ランダム文字列) |
| SAML_ENTRY_POINT | SAML IdPエントリーポイント | `https://extic.example.com/saml2/idp/SSOService.php` |
| SAML_ISSUER | SAML発行者ID | extbridge-saml |
| SAML_CALLBACK_URL | SAMLコールバックURL | `https://extbridge-xxxxx.run.app/auth/saml/callback` |
| GITHUB_CLIENT_ID | GitHub OAuth App ID | (GitHub Developer Settingsから取得) |
| GITHUB_CLIENT_SECRET | GitHub OAuth App Secret | (GitHub Developer Settingsから取得) |
| GITHUB_CALLBACK_URL | GitHub OAuthコールバックURL | `https://extbridge-xxxxx.run.app/api/services/github/callback` |
| FIGMA_CLIENT_ID | Figma OAuth App ID | (Figma Developer Settingsから取得) |
| FIGMA_CLIENT_SECRET | Figma OAuth App Secret | (Figma Developer Settingsから取得) |
| FIGMA_CALLBACK_URL | Figma OAuthコールバックURL | `https://extbridge-xxxxx.run.app/api/services/figma/callback` |
| SLACK_CLIENT_ID | Slack App ID | (Slack App Settingsから取得) |
| SLACK_CLIENT_SECRET | Slack App Secret | (Slack App Settingsから取得) |
| SLACK_CALLBACK_URL | Slack OAuthコールバックURL | `https://extbridge-xxxxx.run.app/api/services/slack/callback` |

#### 11.1.3 手動デプロイ手順

1. **プロジェクトのクローン**

   ```bash
   git clone https://github.com/your-org/extbridge.git
   cd extbridge
   ```

2. **Dockerイメージのビルド**

   ```bash
   docker build -t gcr.io/[PROJECT_ID]/extbridge:latest .
   ```

3. **Google Container Registryへのプッシュ**

   ```bash
   gcloud auth configure-docker
   docker push gcr.io/[PROJECT_ID]/extbridge:latest
   ```

4. **Cloud Runへのデプロイ**

   ```bash
   gcloud run deploy extbridge \
     --image gcr.io/[PROJECT_ID]/extbridge:latest \
     --platform managed \
     --region [REGION] \
     --allow-unauthenticated \
     --set-env-vars="NODE_ENV=production,PORT=8080,[その他の環境変数]"
   ```

5. **デプロイの確認**

   ```bash
   gcloud run services describe extbridge --platform managed --region [REGION]
   ```

#### 11.1.4 CI/CDによる自動デプロイ

GitHub Actionsを使用した自動デプロイが設定されています。以下のシークレットをGitHubリポジトリに設定する必要があります：

| シークレット名 | 説明 |
|------|------|
| GCP_PROJECT_ID | Google CloudプロジェクトのプロジェクトID |
| GCP_SA_KEY | サービスアカウントキー（JSON形式、Base64エンコード） |
| GCP_REGION | デプロイするリージョン（例：asia-northeast1） |
| MONGODB_URI | MongoDB接続文字列 |
| JWT_SECRET | JWT署名用シークレット |
| SAML_ENTRY_POINT | SAML IdPエントリーポイント |
| SAML_ISSUER | SAML発行者ID |
| SAML_CALLBACK_URL | SAMLコールバックURL |
| GITHUB_CLIENT_ID | GitHub OAuth App ID |
| GITHUB_CLIENT_SECRET | GitHub OAuth App Secret |
| GITHUB_CALLBACK_URL | GitHub OAuth コールバックURL |
| FIGMA_CLIENT_ID | Figma OAuth App ID |
| FIGMA_CLIENT_SECRET | Figma OAuth App Secret |
| FIGMA_CALLBACK_URL | Figma OAuth コールバックURL |
| SLACK_CLIENT_ID | Slack App ID |
| SLACK_CLIENT_SECRET | Slack App Secret |
| SLACK_CALLBACK_URL | Slack OAuth コールバックURL |

自動デプロイの流れ：

1. mainブランチへのプッシュまたはプルリクエストのマージ
2. GitHub Actionsワークフローの起動
3. テストの実行
4. Dockerイメージのビルドとプッシュ
5. Cloud Runへのデプロイ

#### 11.1.5 デプロイ後の設定

1. **カスタムドメインの設定**
   - Cloud Run管理コンソールからカスタムドメインをマッピング
   - DNSレコードの更新

2. **モニタリングの設定**
   - Cloud Monitoringでアラートを設定
   - ログエクスポートの設定

3. **バックアップ戦略**
   - データベースの定期バックアップを設定
   - 環境変数の安全な保管